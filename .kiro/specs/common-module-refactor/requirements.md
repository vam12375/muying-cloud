# Common模块重构需求文档

## 项目概述

将现有的单体`muying-mall-common`模块重构为多模块架构，参考`muying-cloud-ruoyi`项目的设计模式，实现功能分离和依赖优化。

## 需求分析

### 需求1：模块化架构设计

**用户故事：** 作为开发者，我希望common模块采用多模块架构，以便各微服务可以按需引入特定功能，减少不必要的依赖。

#### 验收标准

1. WHEN 开发者需要使用Redis功能 THEN 系统应该允许只引入redis子模块而不引入其他无关功能
2. WHEN 开发者需要使用Swagger功能 THEN 系统应该允许独立引入swagger子模块
3. WHEN 开发者查看项目结构 THEN 应该看到清晰的功能分离和模块边界
4. WHEN 构建项目 THEN 各子模块应该能够独立编译和打包

### 需求2：核心功能模块拆分

**用户故事：** 作为系统架构师，我希望将现有功能按职责拆分为独立的子模块，以便提高代码的可维护性和复用性。

#### 验收标准

1. WHEN 拆分完成后 THEN 应该存在muying-mall-common-core模块包含基础功能
2. WHEN 拆分完成后 THEN 应该存在muying-mall-common-redis模块包含缓存相关功能
3. WHEN 拆分完成后 THEN 应该存在muying-mall-common-swagger模块包含API文档功能
4. WHEN 拆分完成后 THEN 应该存在muying-mall-common-security模块包含安全相关功能
5. WHEN 拆分完成后 THEN 应该存在muying-mall-common-rabbitmq模块包含消息队列功能
6. WHEN 拆分完成后 THEN 应该存在muying-mall-common-web模块包含Web相关功能

### 需求3：依赖关系优化

**用户故事：** 作为开发者，我希望各子模块的依赖关系清晰合理，避免循环依赖和不必要的传递依赖。

#### 验收标准

1. WHEN 检查模块依赖 THEN core模块应该是最基础的模块，不依赖其他common子模块
2. WHEN 检查模块依赖 THEN 其他子模块可以依赖core模块，但不应该相互依赖
3. WHEN 构建项目 THEN 不应该出现循环依赖错误
4. WHEN 微服务引入子模块 THEN 应该只引入必要的传递依赖

### 需求4：代码迁移和重构

**用户故事：** 作为开发者，我希望现有代码能够平滑迁移到新的模块结构中，并保持功能完整性。

#### 验收标准

1. WHEN 迁移基础类 THEN 所有异常类、枚举类、常量类应该迁移到core模块
2. WHEN 迁移工具类 THEN 通用工具类应该迁移到core模块，专用工具类迁移到对应功能模块
3. WHEN 迁移配置类 THEN Redis配置应该迁移到redis模块，Swagger配置迁移到swagger模块
4. WHEN 迁移完成后 THEN 所有现有功能应该保持不变
5. WHEN 运行测试 THEN 所有单元测试应该通过

### 需求5：包结构标准化

**用户故事：** 作为开发者，我希望各模块的包结构遵循统一的命名规范，便于理解和维护。

#### 验收标准

1. WHEN 查看包结构 THEN 应该统一使用com.muyingmall.common.{module}的命名规范
2. WHEN 查看包结构 THEN 不应该存在重复或冲突的包名（如constants和constant）
3. WHEN 查看包结构 THEN 每个模块内部应该按功能分包（config、service、util等）
4. WHEN 查看包结构 THEN 应该遵循Maven标准目录结构

### 需求6：向后兼容性

**用户故事：** 作为现有项目维护者，我希望重构后的模块能够保持向后兼容，现有的引用方式仍然可以正常工作。

#### 验收标准

1. WHEN 现有微服务引入muying-mall-common THEN 应该能够通过聚合依赖获得所有功能
2. WHEN 现有代码使用common模块的类 THEN 应该能够正常导入和使用
3. WHEN 运行现有微服务 THEN 应该能够正常启动和运行
4. WHEN 执行现有业务流程 THEN 应该保持原有的功能表现

### 需求7：构建和部署优化

**用户故事：** 作为DevOps工程师，我希望新的模块结构能够支持更灵活的构建和部署策略。

#### 验收标准

1. WHEN 执行Maven构建 THEN 父模块应该能够统一管理所有子模块的构建
2. WHEN 执行Maven构建 THEN 各子模块应该能够独立构建和发布
3. WHEN 查看构建产物 THEN 各子模块应该生成独立的jar包
4. WHEN 发布到仓库 THEN 各子模块应该能够独立版本管理

## 技术约束

1. **技术栈兼容性**：必须保持与现有Spring Boot 3.5.5和Spring Cloud 2025.0.0的兼容性
2. **Java版本**：必须支持JDK 21
3. **Maven版本**：必须使用Maven 3.9.9+进行构建
4. **依赖管理**：必须遵循项目现有的依赖版本管理策略

## 成功标准

1. **功能完整性**：所有现有功能在新架构下正常工作
2. **性能保持**：重构后性能不应该有明显下降
3. **依赖优化**：各微服务的依赖包大小应该有所减少
4. **代码质量**：代码结构更清晰，可维护性提升
5. **文档完整**：提供完整的迁移指南和使用文档